<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quản lí món ăn</title>
    <script th:src="@{/webjars/jquery/jquery.min.js}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Ẩn form edit và form add ban đầu
        document.getElementById('editModal').style.display = 'none';
        document.getElementById('addModal').style.display = 'none';

        // Sự kiện nhấn nút close để đóng form edit
        document.getElementById('editCloseBtn').addEventListener('click', function() {
            document.getElementById('editModal').style.display = 'none';
        });

        // Sự kiện nhấn nút close để đóng form add
        document.getElementById('addCloseBtn').addEventListener('click', function() {
            document.getElementById('addModal').style.display = 'none';
        });

        var editBtns = document.querySelectorAll('.editBtn');
        editBtns.forEach(function(editBtn) {
            editBtn.addEventListener('click', function() {
                var id = editBtn.dataset.id;
                var ten = editBtn.dataset.ten;
                var moTa = editBtn.dataset.mota;
                var gia = editBtn.dataset.gia;
                document.getElementById('editForm').querySelector('input[name="id"]').value = id;
                document.getElementById('editForm').querySelector('input[name="ten"]').value = ten;
                document.getElementById('editForm').querySelector('input[name="moTa"]').value = moTa;
                document.getElementById('editForm').querySelector('input[name="gia"]').value = gia;
                document.getElementById('editModal').style.display = 'block';
            });
        });

        document.getElementById('addBtn').addEventListener('click', function() {
            document.getElementById('addModal').style.display = 'block';
        });
    });

    </script>
</head>
<body>
    <h2>Danh sách món ăn</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Tên</th>
                <th>Mô tả</th>
                <th>Giá</th>
                <th>Ảnh</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="monAn : ${danhSachMonAn}">
                <td th:text="${monAn.ten}"></td>
                <td th:text="${monAn.moTa}"></td>
                <td th:text="${monAn.gia}"></td>
                <td th:style="${monAn.trangThai == 'Hoạt động' ? 'background-color: green;' : 'background-color: red;'}"></td>
                <td>
                    <button type="button" class="editBtn" th:data-id="${monAn.id}" th:data-ten="${monAn.ten}" th:data-mota="${monAn.moTa}" th:data-gia="${monAn.gia}">Sửa</button>
                    <a th:href="@{'/admin/monan/delete/' + ${monAn.id}}">Xoá</a>
                </td>
                <td><img th:src="'data:image/jpeg;base64,' + ${monAn.base64Image}" alt="Image"></td>
            </tr>
        </tbody>
    </table>

    <button type="button" id="addBtn">Thêm mới món ăn</button>

    <!-- Modal for edit -->
    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Chỉnh sửa món ăn</h5>
                    <button type="button" class="close" id="editCloseBtn" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editForm" th:action="@{/admin/monan/save}" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="id">
                        <input type="text" name="ten" placeholder="Tên món ăn"><br>
                        <input type="text" name="moTa" placeholder="Mô tả"><br>
                        <input type="number" name="gia" placeholder="Giá"><br>
                        <input type="file" name="file"><br>
                        <input type="submit" value="Cập nhật">
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for add -->
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Thêm mới món ăn</h5>
                    <button type="button" class="close" id="addCloseBtn" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addForm" th:action="@{/admin/monan/save}" method="post" enctype="multipart/form-data">
                        <input type="text" name="ten" placeholder="Tên món ăn"><br>
                        <input type="text" name="moTa" placeholder="Mô tả"><br>
                        <input type="number" name="gia" placeholder="Giá"><br>
                        <input type="file" name="file"><br>
                        <input type="submit" value="Thêm món ăn">
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
